# geoservice

Краткое описание: реализовать микросервисную архитектуру для приложения работающего с геолокацией.
Описание: система состоит из 3 компонентов: брокер, сервис геолокации и cli клиент для создания запросов.
Брокер – компонент системы, который позволяет общаться между собой другим сервисам. Должен реализовывать интерфейс:
type Broker interface {
Register(name string) chan Message // Регистрирует новый сервис в системе, возвращает канал по которому будут приходить запросы
Broadcast(msg Message) // Отправляет сообщение всем зарегистрированным сервисам
Send(target string, msg interface{}) chan interface{} // Отправляет сообщение target сервису и возвращает канал в который будет отправлен ответ
Response(target string, msg interface{}) // Отправляет ответ на указанную ноду
GetServices() []string // Возвращает имена всех зарегистрированных сервисов
}
Каждый сервис, зарегистрированный в брокере должен каждые 2 секунды отправлять Ping сообщение брокеру через метод Send (в этом случае target пустой). Если сервис не отправит сообщение дольше чем 4 секунды, то брокер вызывает закрытие канала ответов (результат функции Register) для этого сервиса. После этого сервис должен пройти цикл перерегистрации.
Следующие шаги должны логироваться:
1) Запрос получен от Кого и Кому
2) Получен ответ от Кого и Кому
Сервис геолокации – сервис, рассчитывающий расстояние между заданной точкой и сохраненной точкой самого сервиса. При запуске сервиса случайным образом генерируется точка в 2D координатах [-1000; 1000]. При получении запроса с координатой сервис рассчитывает расстояние между сохраненной точкой и полученной и отправляет ответ запросившему сервису. Сервис одновременно обрабатывает один запрос. Следующие шаги должны логироваться:
1) Имя сервиса (генерируется уникально с префиксом geo-XXX); локация сервиса (x и y координаты);
2) Координаты сервиса изменены (отобразить новые координаты сервиса);
3) Запрос получен;
4) Ответ отправлен.
CLI клиент – сервис позволяющий задавать позиции точки для которой рассчитывается дистанция. Поддерживает два режима работы:
1) Вводим координаты точки X,Y через запятую. Затем не больше чем в 3 потока отправляются запросы ко всем ГЕО сервисам, вычисляется дистанция до ближайшего. После того как были опрошены все сервисы выводим название ближайшего ГЕО сервиса.
2) Вводим координаты точки X,Y через запятую. Отправляется запрос через Broadcast метод, и ГЕО сервисы получившие его должны сгенерировать заново свою позицию.
Рекомендации к исполнению:
• Можно использовать любые библиотеки кроме готовой реализации брокера;
• У брокера система мониторинга мертвых сервисов должна работать по отдельной
горутине;
• У сервисов система оповещения брокера должна работать в отдельной горутине;
• Отправка сообщений в брокере работает в отдельной горутине;
• Отправка ответов в брокере работает в отдельной горутине;
• В приложении может быть зарегистрировано более 1 сервиса каждого типа;
• CLI сервис отправляет запросы не более чем в 3 потока.
Пример работы системы:
Запускается приложение, создается брокер и 5 ГЕО сервиса (для каждого сервиса генерируется уникальное имя и позиция). ГЕО сервисы регистрируются в брокере и получают каналы для получения запросов. После регистрации в каждом ГЕО сервисе запускается горутина для оповещения брокера о том, что они живы. Запускается CLI клиент и регистрируется в брокере, управление передается пользователю в консоль. Пользователь выбирает первый пункт (найти ближайший ГЕО сервис к указанной точке), указывает координату X,Y. CLI сервис получает имена всех известных сервисов и по шаблону выбирает тех кто имеет префикс “geo-XXX” и отправляет запрос каждому ГЕО сервису (асинхронно, но максимум в 3 потока). Broker через метод Send получает запрос и маршрутизирует его заданному ГЕО сервису. Когда ГЕО сервис готов отправить ответ, он отправляет ответ через метод Response. Когда CLI сервис готов принять решение о том какой ГЕО сервис самый близкий к указанной точки, то выводит имя этого сервиса на экран и возвращает управление в начальное меню. В случае если был выбран пункт обновления позиций ГЕО сервисов, то отправляет Broadcast сообщение всем ГЕО сервисам.